package resolvers

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.74

import (
	"context"
	"strconv"

	"github.com/polatbilal/gqlgen-ent/ent"
	"github.com/polatbilal/gqlgen-ent/ent/jobdetail"
	"github.com/polatbilal/gqlgen-ent/graphql/model"
	"github.com/polatbilal/gqlgen-ent/middlewares"
)

// UpsertProgress is the resolver for the upsertProgress field.
func (r *mutationResolver) UpsertProgress(ctx context.Context, input model.JobProgressInput) (*ent.JobProgress, error) {
	client := middlewares.GetClientFromContext(ctx)

	if input.ID != nil {
		// ID varsa güncelleme işlemi yap
		id, err := strconv.Atoi(*input.ID)
		if err != nil {
			return nil, err
		}
		return client.JobProgress.UpdateOneID(id).
			SetNillableOne(input.One).
			SetNillableTwo(input.Two).
			SetNillableThree(input.Three).
			SetNillableFour(input.Four).
			SetNillableFive(input.Five).
			SetNillableSix(input.Six).
			Save(ctx)
	}

	// ID yoksa yeni kayıt oluştur
	return client.JobProgress.Create().
		SetNillableOne(input.One).
		SetNillableTwo(input.Two).
		SetNillableThree(input.Three).
		SetNillableFour(input.Four).
		SetNillableFive(input.Five).
		SetNillableSix(input.Six).
		Save(ctx)
}

// Progress is the resolver for the progress field.
func (r *queryResolver) Progress(ctx context.Context, yibfNo int) (*ent.JobProgress, error) {
	client := middlewares.GetClientFromContext(ctx)

	// Önce JobDetail'i bul
	jobDetail, err := client.JobDetail.Query().
		Where(jobdetail.YibfNoEQ(yibfNo)).
		Only(ctx)
	if err != nil {
		return nil, err
	}

	// JobRelations üzerinden Progress'i bul
	relations, err := jobDetail.QueryRelations().Only(ctx)
	if err != nil {
		return nil, err
	}

	progress, err := relations.QueryProgress().Only(ctx)
	if err != nil {
		return nil, err
	}

	return progress, nil
}
